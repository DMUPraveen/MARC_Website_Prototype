---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumb from "../../components/Breadcrumb.astro";

// 1. Generate Static Paths for all news items
export async function getStaticPaths() {
    const news = await getCollection("news");
    return news.map((item) => ({
        params: { slug: item.id },
        props: { item },
    }));
}

// 2. Get Props and Render Content
const { item } = Astro.props;
const { Content } = await render(item);
---

<BaseLayout title={item.data.title}>
    <div class="max-w-4xl mx-auto px-4 py-8">
        <Breadcrumb>
            <li><a href="/">Home</a></li>
            <li><a href="/news">News</a></li>
            <li class="opacity-70 truncate max-w-[200px]">{item.data.title}</li>
        </Breadcrumb>

        <article class="mt-8">
            {/* Header Section */}
            <header class="mb-8 text-center">
                <div
                    class="mb-4 flex items-center justify-center gap-2 text-sm text-base-content/60 font-mono"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-4 h-4"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z"
                            clip-rule="evenodd"></path>
                    </svg>
                    {
                        item.data.date.toLocaleDateString("en-US", {
                            weekday: "long",
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                        })
                    }
                </div>

                <h1
                    class="text-3xl md:text-5xl font-extrabold text-base-content leading-tight mb-6"
                >
                    {item.data.title}
                </h1>
            </header>

            {/* Hero Image */}
            {
                item.data.cover && (
                    <div class="rounded-2xl overflow-hidden shadow-lg mb-10 border border-base-200">
                        <Image
                            src={item.data.cover}
                            alt={item.data.title}
                            width={900}
                            height={500}
                            class="w-full h-auto object-cover"
                            priority
                        />
                    </div>
                )
            }

            {/* Main Content */}
            <div
                class="prose prose-lg max-w-none prose-headings:text-primary prose-img:rounded-xl mx-auto"
            >
                {/* Optional: Display the summary as a lead paragraph */}
                <p
                    class="lead text-xl text-base-content/80 not-prose mb-8 italic border-l-4 border-primary pl-4"
                >
                    {item.data.short}
                </p>

                <Content />
            </div>
        </article>
    </div>
</BaseLayout>
